---
title: "Response Object Deep Dive"
---

Objek `res` (response) adalah parameter kedua dalam callback route handler yang
digunakan untuk mengirim respons HTTP kembali ke client. Response object
menyediakan berbagai property dan method untuk mengontrol bagaimana data dikirim
ke browser, termasuk setting headers, cookies, status codes, dan format content.

## Apa itu Response Object?

Response object merepresentasikan HTTP response yang akan dikirim Express app ke
client ketika menerima HTTP request. Objek `res` dibuat otomatis oleh framework
dan di-pass sebagai argument ke route handler functions. Developer menggunakan
objek ini untuk set response headers, body, dan mengirim response ke client.

```javascript
app.get("/example", (req, res) => {
  // res digunakan untuk mengirim response ke client
  res.send("Hello World");
});
```

## Property Penting dari res

### res.app

Property ini menyimpan reference ke instance aplikasi Express yang menggunakan
middleware tersebut. Sangat berguna untuk mengakses configuration aplikasi atau
variabel global yang di-set di level aplikasi.

```javascript
import express from "express";
const app = express();

// Set application variable
app.set("appName", "My Awesome App");
app.set("version", "1.0.0");

app.get("/", (req, res) => {
  // Akses app settings melalui res.app
  const appName = res.app.get("appName");
  const version = res.app.get("version");

  console.log(res.app === app); // true

  res.json({
    name: appName,
    version: version,
  });
});
```

### res.headersSent

Property boolean yang menunjukkan apakah HTTP headers sudah dikirim ke client.
Ini penting untuk error handling karena setelah headers terkirim, tidak bisa
lagi mengubah status code atau headers.

```javascript
app.get("/check-headers", (req, res) => {
  console.log("Before send:", res.headersSent); // false

  res.send("Hello");

  console.log("After send:", res.headersSent); // true

  // Ini akan error karena headers sudah terkirim
  // res.status(404).send('Not Found'); // Error!
});

// Contoh penggunaan dalam middleware
app.use((req, res, next) => {
  if (!res.headersSent) {
    // Aman untuk mengubah headers
    res.setHeader("X-Custom-Header", "value");
  }
  next();
});
```

### res.locals

Objek yang berisi response local variables yang scoped ke request saat ini.
Sangat berguna untuk passing data dari middleware ke views atau middleware
berikutnya dalam chain yang sama.

```javascript
import express from "express";
const app = express();

app.set("view engine", "ejs");

// Middleware untuk set data umum
app.use((req, res, next) => {
  res.locals.appName = "My Blog";
  res.locals.currentYear = new Date().getFullYear();
  res.locals.user = req.user || null;
  next();
});

// Route specific middleware
app.use("/dashboard", (req, res, next) => {
  res.locals.pageTitle = "Dashboard";
  res.locals.menuActive = "dashboard";
  next();
});

app.get("/dashboard", (req, res) => {
  // res.locals otomatis tersedia di template
  res.render("dashboard", {
    // Data tambahan khusus untuk route ini
    stats: { views: 1234, posts: 45 },
  });
});

// Di template EJS:
// <%= appName %> - <%= pageTitle %>
// &copy; <%= currentYear %>
```

## Method Penting dari res

### res.send([body])

Method paling umum untuk mengirim response. Bisa menerima berbagai tipe data:
string, object, array, atau Buffer. Express otomatis set Content-Type header
yang sesuai.

```javascript
app.get("/text", (req, res) => {
  res.send("Plain text response");
  // Content-Type: text/html
});

app.get("/html", (req, res) => {
  res.send("<h1>HTML Response</h1>");
  // Content-Type: text/html
});

app.get("/object", (req, res) => {
  res.send({ message: "Object response" });
  // Content-Type: application/json
});

app.get("/array", (req, res) => {
  res.send([1, 2, 3, 4, 5]);
  // Content-Type: application/json
});

app.get("/buffer", (req, res) => {
  const buffer = Buffer.from("Buffer data");
  res.send(buffer);
});
```

### res.json([body])

Mengirim response dalam format JSON. Secara otomatis set Content-Type ke
`application/json` dan convert object JavaScript menjadi JSON string.

```javascript
app.get("/api/users", (req, res) => {
  const users = [
    { id: 1, name: "Alice", email: "alice@example.com" },
    { id: 2, name: "Bob", email: "bob@example.com" },
  ];

  res.json(users);
});

app.get("/api/status", (req, res) => {
  res.json({
    status: "ok",
    timestamp: new Date(),
    uptime: process.uptime(),
  });
});

// Dengan null atau undefined
app.get("/api/empty", (req, res) => {
  res.json(null); // Mengirim "null"
});
```

**Perbedaan res.send() vs res.json()**:

- `res.json()` selalu mengirim JSON, bahkan untuk null/undefined
- `res.send()` lebih fleksibel, bisa mengirim berbagai format
- `res.json()` melakukan `JSON.stringify()` secara eksplisit
- Best practice: gunakan `res.json()` untuk API endpoints

### res.status(code)

Set HTTP status code untuk response. Method ini chainable, jadi bisa digabung
dengan method lain.

```javascript
// Method chaining
app.get("/not-found", (req, res) => {
  res.status(404).send("Page not found");
});

app.post("/api/users", (req, res) => {
  // Simulasi create user
  const newUser = { id: 123, ...req.body };
  res.status(201).json({
    message: "User created successfully",
    user: newUser,
  });
});

app.delete("/api/users/:id", (req, res) => {
  // No content response
  res.status(204).send();
});

app.get("/api/error", (req, res) => {
  res.status(500).json({
    error: "Internal Server Error",
    message: "Something went wrong",
  });
});
```

**Status codes umum**:

- 200 OK - Request berhasil
- 201 Created - Resource berhasil dibuat
- 204 No Content - Request berhasil tanpa response body
- 400 Bad Request - Request tidak valid
- 401 Unauthorized - Butuh authentication
- 403 Forbidden - Tidak punya permission
- 404 Not Found - Resource tidak ditemukan
- 500 Internal Server Error - Error di server

### res.redirect([status,] path)

Redirect client ke URL lain. Default status code adalah 302 (Found), bisa diubah
dengan parameter pertama.

```javascript
// Redirect default (302)
app.get("/old-page", (req, res) => {
  res.redirect("/new-page");
});

// Redirect permanent (301)
app.get("/old-url", (req, res) => {
  res.redirect(301, "/new-url");
});

// Redirect ke URL external
app.get("/google", (req, res) => {
  res.redirect("https://www.google.com");
});

// Redirect back ke previous page
app.post("/form-submit", (req, res) => {
  // Process form...
  res.redirect("back");
});

// Redirect dengan status 303 (See Other)
app.post("/login", (req, res) => {
  // Process login...
  res.redirect(303, "/dashboard");
});
```

### res.render(view [, locals] [, callback])

Render view template dan kirim HTML response. Memerlukan template engine seperti
EJS, Pug, atau Handlebars.

```javascript
import express from "express";
const app = express();

// Setup view engine
app.set("view engine", "ejs");
app.set("views", "./views");

app.get("/profile", (req, res) => {
  const user = {
    name: "John Doe",
    email: "john@example.com",
    age: 30,
  };

  // Render views/profile.ejs dengan data user
  res.render("profile", { user });
});

app.get("/posts", (req, res) => {
  const posts = [
    { id: 1, title: "First Post", content: "Content 1" },
    { id: 2, title: "Second Post", content: "Content 2" },
  ];

  res.render("posts", {
    posts,
    pageTitle: "All Posts",
    currentUser: req.user,
  });
});

// Dengan callback
app.get("/custom", (req, res) => {
  res.render("template", { data: "value" }, (err, html) => {
    if (err) {
      console.error(err);
      return res.status(500).send("Render error");
    }
    // Modifikasi HTML sebelum dikirim
    const modifiedHtml = html.replace("{{timestamp}}", Date.now());
    res.send(modifiedHtml);
  });
});
```

### res.sendFile(path [, options] [, callback])

Mengirim file sebagai response. Path harus absolute atau menggunakan option
`root`.

```javascript
import express from "express";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();

app.get("/download-pdf", (req, res) => {
  const filePath = path.join(__dirname, "files", "document.pdf");
  res.sendFile(filePath);
});

// Dengan options
app.get("/image", (req, res) => {
  const options = {
    root: path.join(__dirname, "public"),
    dotfiles: "deny",
    headers: {
      "x-timestamp": Date.now(),
      "x-sent": true,
    },
  };

  res.sendFile("images/logo.png", options, (err) => {
    if (err) {
      console.error(err);
      res.status(404).send("File not found");
    } else {
      console.log("File sent successfully");
    }
  });
});

// Static HTML file
app.get("/", (req, res) => {
  res.sendFile(path.join(__dirname, "public", "index.html"));
});
```

### res.download(path [, filename] [, callback])

Transfer file sebagai attachment dengan prompt download di browser.

```javascript
app.get("/download/report", (req, res) => {
  const filePath = path.join(__dirname, "reports", "monthly.pdf");
  res.download(filePath);
  // Browser akan prompt: Save "monthly.pdf"
});

// Custom filename
app.get("/download/custom", (req, res) => {
  const filePath = path.join(__dirname, "files", "12345.pdf");
  res.download(filePath, "Invoice-2025.pdf");
  // Browser akan prompt: Save "Invoice-2025.pdf"
});

// Dengan error handling
app.get("/download/:fileId", (req, res) => {
  const filePath = path.join(__dirname, "files", `${req.params.fileId}.pdf`);

  res.download(filePath, (err) => {
    if (err) {
      if (!res.headersSent) {
        res.status(404).send("File not found");
      }
    }
  });
});
```

### res.cookie(name, value [, options])

Set cookie di browser client. Cookie akan tersimpan di client dan dikirim
kembali dalam request berikutnya.

```javascript
app.get("/set-cookie", (req, res) => {
  // Simple cookie
  res.cookie("username", "john_doe");
  res.send("Cookie set");
});

// Dengan options
app.get("/login", (req, res) => {
  res.cookie("sessionId", "12345-abcde", {
    maxAge: 900000, // 15 menit in milliseconds
    httpOnly: true, // Tidak bisa diakses via JavaScript
    secure: true, // Hanya dikirim via HTTPS
    sameSite: "strict", // CSRF protection
    path: "/", // Cookie path
    domain: "example.com", // Cookie domain
  });

  res.cookie("user", JSON.stringify({ name: "John", role: "admin" }), {
    maxAge: 86400000, // 24 jam
    httpOnly: true,
  });

  res.send("Login successful");
});

// Signed cookie (memerlukan cookie-parser dengan secret)
app.get("/set-signed", (req, res) => {
  res.cookie("userId", "123", { signed: true });
  res.send("Signed cookie set");
});
```

### res.clearCookie(name [, options])

Hapus cookie dari browser client.

```javascript
app.get("/logout", (req, res) => {
  res.clearCookie("sessionId");
  res.clearCookie("user");
  res.redirect("/login");
});

// Options harus sama dengan saat set cookie
app.get("/clear-all", (req, res) => {
  res.clearCookie("sessionId", {
    path: "/",
    httpOnly: true,
  });
  res.send("All cookies cleared");
});
```

### res.set(field [, value]) atau res.header()

Set HTTP response headers. `res.header()` adalah alias dari `res.set()`.

```javascript
app.get("/custom-headers", (req, res) => {
  // Set single header
  res.set("Content-Type", "text/html");
  res.set("X-Custom-Header", "MyValue");

  res.send("<h1>Check response headers</h1>");
});

// Set multiple headers dengan object
app.get("/multiple-headers", (req, res) => {
  res.set({
    "Content-Type": "application/json",
    "X-API-Version": "1.0.0",
    "X-Response-Time": "150ms",
    "Cache-Control": "no-cache",
  });

  res.json({ data: "value" });
});

// Menggunakan res.header()
app.get("/alias", (req, res) => {
  res.header("X-Custom", "Value");
  res.send("Using header() alias");
});
```

### res.get(field)

Mendapatkan nilai dari response header yang sudah di-set.

```javascript
app.get("/get-header", (req, res) => {
  res.set("X-Custom-Header", "MyValue");

  const customHeader = res.get("X-Custom-Header");
  console.log(customHeader); // 'MyValue'

  res.send(`Custom header value: ${customHeader}`);
});
```

### res.type(type)

Set Content-Type header. Bisa menggunakan MIME type atau file extension.

```javascript
app.get("/type-json", (req, res) => {
  res.type("json");
  res.send({ message: "JSON response" });
});

app.get("/type-html", (req, res) => {
  res.type("html");
  res.send("<h1>HTML</h1>");
});

app.get("/type-text", (req, res) => {
  res.type("text/plain");
  res.send("Plain text");
});

// Menggunakan file extension
app.get("/type-xml", (req, res) => {
  res.type("xml");
  res.send("<note><body>Message</body></note>");
});
```

### res.format(object)

Melakukan content negotiation berdasarkan Accept header dari request. Server
memilih format response berdasarkan preferensi client.

```javascript
app.get("/data", (req, res) => {
  res.format({
    "text/plain": () => {
      res.send("Plain text data");
    },

    "text/html": () => {
      res.send("<html><body><h1>HTML Data</h1></body></html>");
    },

    "application/json": () => {
      res.json({ message: "JSON data", items: [1, 2, 3] });
    },

    "application/xml": () => {
      res.type("xml");
      res.send("<data><message>XML data</message></data>");
    },

    default: () => {
      // Jika tidak ada yang cocok
      res.status(406).send("Not Acceptable");
    },
  });
});
```

### res.end([data] [, encoding])

Mengakhiri response process. Digunakan untuk mengirim response tanpa data atau
untuk mengakhiri proses setelah streaming.

```javascript
app.get("/end-simple", (req, res) => {
  res.end();
  // Response tanpa body, hanya headers
});

app.get("/end-with-data", (req, res) => {
  res.end("Response ended");
});

// Untuk streaming
app.get("/stream", (req, res) => {
  res.write("Part 1\n");
  res.write("Part 2\n");
  res.write("Part 3\n");
  res.end("Final part");
});
```

## Contoh Praktis Komprehensif

```javascript
import express from "express";
import path from "path";
import cookieParser from "cookie-parser";

const app = express();
const port = 3000;

// Middleware
app.use(express.json());
app.use(cookieParser());
app.set("view engine", "ejs");

// Global middleware untuk res.locals
app.use((req, res, next) => {
  res.locals.siteName = "My Website";
  res.locals.currentYear = new Date().getFullYear();
  next();
});

// Text response
app.get("/text", (req, res) => {
  res.type("text/plain");
  res.send("This is plain text");
});

// JSON API endpoint
app.get("/api/users", (req, res) => {
  const users = [
    { id: 1, name: "Alice" },
    { id: 2, name: "Bob" },
  ];

  res.status(200).json({
    success: true,
    count: users.length,
    data: users,
  });
});

// Render view
app.get("/dashboard", (req, res) => {
  res.render("dashboard", {
    user: { name: "John", role: "admin" },
    stats: { views: 1234, posts: 56 },
  });
});

// File download
app.get("/download", (req, res) => {
  const filePath = path.join(__dirname, "files", "document.pdf");
  res.download(filePath, "My-Document.pdf");
});

// Cookie operations
app.post("/login", (req, res) => {
  // Set cookies
  res.cookie("sessionId", "abc123", {
    maxAge: 3600000,
    httpOnly: true,
  });
  res.cookie("username", req.body.username);

  res.status(200).json({ message: "Login successful" });
});

app.get("/logout", (req, res) => {
  res.clearCookie("sessionId");
  res.clearCookie("username");
  res.redirect("/");
});

// Content negotiation
app.get("/resource", (req, res) => {
  const data = { id: 1, name: "Resource" };

  res.format({
    "application/json": () => res.json(data),
    "text/html": () => res.send(`<h1>${data.name}</h1>`),
    default: () => res.status(406).send("Not Acceptable"),
  });
});

// Custom headers
app.get("/api/protected", (req, res) => {
  res.set({
    "X-API-Version": "1.0.0",
    "X-Rate-Limit": "100",
    "Cache-Control": "no-cache",
  });

  res.json({ message: "Protected data" });
});

// Redirect
app.get("/old-url", (req, res) => {
  res.redirect(301, "/new-url");
});

// Error response
app.get("/error", (req, res) => {
  res.status(500).json({
    error: "Internal Server Error",
    message: "Something went wrong",
  });
});

// 404 handler
app.use((req, res) => {
  res.status(404).format({
    "application/json": () => res.json({ error: "Not Found" }),
    "text/html": () => res.send("<h1>404 - Page Not Found</h1>"),
    default: () => res.send("Not Found"),
  });
});

app.listen(port, () => {
  console.log(`Server running on port ${port}`);
});
```

## Best Practices

**Selalu set status code yang tepat**: Gunakan status code HTTP yang sesuai
dengan hasil operasi (200, 201, 400, 404, 500, dll).

**Gunakan method yang tepat**: Pilih `res.json()` untuk API, `res.render()`
untuk views, `res.send()` untuk mixed content.

**Cookie security**: Selalu gunakan `httpOnly: true` dan `secure: true` (untuk
HTTPS) pada cookies sensitif.

**Content negotiation**: Gunakan `res.format()` untuk API yang mendukung
multiple formats.

**Error handling**: Selalu check `res.headersSent` sebelum mengirim response
dalam error handler.

**Method chaining**: Manfaatkan chainable methods seperti
`res.status(404).json({})`.

**Don't send multiple responses**: Jangan panggil response methods lebih dari
sekali untuk satu request.

**Set security headers**: Gunakan headers seperti `X-Content-Type-Options`,
`X-Frame-Options` untuk security.

---

**Ringkasan**: Response object adalah tools utama untuk mengirim data dari
server ke client dengan berbagai property seperti `res.app`, `res.headersSent`,
`res.locals` dan method seperti `res.send()`, `res.json()`, `res.status()`,
`res.redirect()`, `res.render()`, `res.sendFile()`, `res.download()`,
`res.cookie()`, `res.clearCookie()`, `res.set()`, `res.type()`, `res.format()`,
dan `res.end()`. Memahami kapan dan bagaimana menggunakan setiap method adalah
kunci untuk membuat aplikasi web dan API yang efektif, aman, dan sesuai dengan
standar HTTP.
