---
title: "Capstone Project - API-Powered Blog with EJS"
---

Setelah mempelajari API integration, Axios, EJS templating, dan partials di sesi
2.1-2.6, sekarang saatnya mengintegrasikan semua konsep tersebut dalam project
lengkap: **Dynamic Blog Application** yang mengambil data dari external API dan
menampilkannya dengan EJS templates yang elegant.

## Overview Project

Kita akan membuat aplikasi blog lengkap dengan fitur:

- Fetch posts dari JSONPlaceholder API
- Display post list dengan pagination
- View single post dengan comments
- Search dan filter posts
- Create new post (simulasi)
- Responsive design dengan EJS partials
- Error handling yang robust

## Setup Project

### 1. Initialize Project

```bash
mkdir dynamic-blog
cd dynamic-blog
npm init -y
npm install express axios ejs express-ejs-layouts dotenv
npm install --save-dev nodemon
```

### 2. Project Structure

```
dynamic-blog/
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.ejs
‚îÇ   ‚îú‚îÄ‚îÄ partials/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ head.ejs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ header.ejs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navbar.ejs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ footer.ejs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ post-card.ejs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comment.ejs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pagination.ejs
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ home.ejs
‚îÇ       ‚îú‚îÄ‚îÄ posts.ejs
‚îÇ       ‚îú‚îÄ‚îÄ post-detail.ejs
‚îÇ       ‚îú‚îÄ‚îÄ create-post.ejs
‚îÇ       ‚îî‚îÄ‚îÄ error.ejs
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ main.js
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ index.js
‚îî‚îÄ‚îÄ package.json
```

### 3. File .env

```
PORT=3000
API_BASE_URL=https://jsonplaceholder.typicode.com
NODE_ENV=development
```

### 4. File package.json

```json
{
  "name": "dynamic-blog",
  "version": "1.0.0",
  "type": "module",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js"
  },
  "dependencies": {
    "axios": "^1.6.0",
    "dotenv": "^16.3.1",
    "ejs": "^3.1.9",
    "express": "^4.18.2",
    "express-ejs-layouts": "^2.5.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

## Server Implementation

### File index.js - Main Server

```javascript
import express from "express";
import axios from "axios";
import dotenv from "dotenv";
import expressLayouts from "express-ejs-layouts";
import path from "path";
import { fileURLToPath } from "url";

dotenv.config();

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();
const port = process.env.PORT || 3000;
const API_BASE_URL = process.env.API_BASE_URL;

// ============================================
// MIDDLEWARE SETUP
// ============================================

app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(express.static("public"));

// EJS Configuration
app.set("view engine", "ejs");
app.set("views", path.join(__dirname, "views"));
app.use(expressLayouts);
app.set("layout", "layouts/main");

// Global locals middleware
app.use((req, res, next) => {
  res.locals.siteName = "Dynamic Blog";
  res.locals.currentYear = new Date().getFullYear();
  res.locals.currentPath = req.path;
  next();
});

// ============================================
// AXIOS INSTANCE
// ============================================

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

// ============================================
// HELPER FUNCTIONS
// ============================================

function paginate(items, page = 1, limit = 9) {
  const offset = (page - 1) * limit;
  const paginatedItems = items.slice(offset, offset + limit);
  const totalPages = Math.ceil(items.length / limit);

  return {
    data: paginatedItems,
    currentPage: page,
    totalPages: totalPages,
    totalItems: items.length,
    hasNext: page < totalPages,
    hasPrev: page > 1,
  };
}

function truncateText(text, maxLength = 150) {
  return text.length > maxLength ? text.substring(0, maxLength) + "..." : text;
}

// ============================================
// ROUTES - HOME
// ============================================

app.get("/", async (req, res) => {
  try {
    // Fetch latest posts
    const postsResponse = await api.get("/posts");
    const posts = postsResponse.data.slice(0, 6);

    // Fetch users for author info
    const usersResponse = await api.get("/users");
    const users = usersResponse.data;

    // Create user map
    const userMap = {};
    users.forEach((user) => {
      userMap[user.id] = user;
    });

    res.render("pages/home", {
      pageTitle: "Home",
      posts: posts,
      users: userMap,
      truncateText: truncateText,
    });
  } catch (error) {
    console.error("Error fetching home data:", error.message);
    res.status(500).render("pages/error", {
      pageTitle: "Error",
      error: "Failed to load home page",
      layout: false,
    });
  }
});

// ============================================
// ROUTES - POSTS
// ============================================

// GET - All posts with pagination
app.get("/posts", async (req, res) => {
  try {
    const page = parseInt(req.query.page) || 1;
    const search = req.query.search || "";

    // Fetch all posts
    const postsResponse = await api.get("/posts");
    let posts = postsResponse.data;

    // Search filter
    if (search) {
      posts = posts.filter(
        (post) =>
          post.title.toLowerCase().includes(search.toLowerCase()) ||
          post.body.toLowerCase().includes(search.toLowerCase())
      );
    }

    // Fetch users
    const usersResponse = await api.get("/users");
    const users = usersResponse.data;
    const userMap = {};
    users.forEach((user) => {
      userMap[user.id] = user;
    });

    // Paginate
    const paginatedData = paginate(posts, page, 9);

    res.render("pages/posts", {
      pageTitle: "All Posts",
      posts: paginatedData.data,
      users: userMap,
      pagination: paginatedData,
      search: search,
      truncateText: truncateText,
    });
  } catch (error) {
    console.error("Error fetching posts:", error.message);
    res.status(500).render("pages/error", {
      pageTitle: "Error",
      error: "Failed to load posts",
      layout: false,
    });
  }
});

// GET - Single post detail
app.get("/posts/:id", async (req, res) => {
  try {
    const postId = req.params.id;

    // Fetch post, user, and comments in parallel
    const [postResponse, usersResponse, commentsResponse] = await Promise.all([
      api.get(`/posts/${postId}`),
      api.get("/users"),
      api.get(`/posts/${postId}/comments`),
    ]);

    const post = postResponse.data;
    const users = usersResponse.data;
    const comments = commentsResponse.data;

    // Find author
    const author = users.find((u) => u.id === post.userId);

    res.render("pages/post-detail", {
      pageTitle: post.title,
      post: post,
      author: author,
      comments: comments,
    });
  } catch (error) {
    if (error.response?.status === 404) {
      res.status(404).render("pages/error", {
        pageTitle: "Not Found",
        error: "Post not found",
        layout: false,
      });
    } else {
      console.error("Error fetching post:", error.message);
      res.status(500).render("pages/error", {
        pageTitle: "Error",
        error: "Failed to load post",
        layout: false,
      });
    }
  }
});

// ============================================
// ROUTES - CREATE POST
// ============================================

// GET - Create post form
app.get("/create", (req, res) => {
  res.render("pages/create-post", {
    pageTitle: "Create New Post",
  });
});

// POST - Submit new post
app.post("/create", async (req, res) => {
  try {
    const { title, body, userId } = req.body;

    // Validation
    if (!title || !body) {
      return res.status(400).render("pages/create-post", {
        pageTitle: "Create New Post",
        error: "Title and body are required",
        formData: req.body,
      });
    }

    // Create post via API
    const response = await api.post("/posts", {
      title: title,
      body: body,
      userId: parseInt(userId) || 1,
    });

    console.log("Post created:", response.data);

    // Redirect to posts page
    res.redirect("/posts");
  } catch (error) {
    console.error("Error creating post:", error.message);
    res.status(500).render("pages/create-post", {
      pageTitle: "Create New Post",
      error: "Failed to create post",
      formData: req.body,
    });
  }
});

// ============================================
// ERROR HANDLING
// ============================================

// 404 handler
app.use((req, res) => {
  res.status(404).render("pages/error", {
    pageTitle: "Not Found",
    error: "Page not found",
    layout: false,
  });
});

// Global error handler
app.use((err, req, res, next) => {
  console.error("Error occurred:", err.stack);
  res.status(500).render("pages/error", {
    pageTitle: "Error",
    error: "Something went wrong",
    layout: false,
  });
});

// ============================================
// START SERVER
// ============================================

app.listen(port, () => {
  console.log("========================================");
  console.log("üìù Dynamic Blog Application");
  console.log("========================================");
  console.log(`Server: http://localhost:${port}`);
  console.log(`API: ${API_BASE_URL}`);
  console.log("\nAvailable Routes:");
  console.log("  GET  /              - Home page");
  console.log("  GET  /posts         - All posts with pagination");
  console.log("  GET  /posts/:id     - Single post detail");
  console.log("  GET  /create        - Create post form");
  console.log("  POST /create        - Submit new post");
  console.log("========================================");
});
```

## EJS Templates

### Layout Main

**views/layouts/main.ejs**:

```html
<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head') %>
  <body>
    <%- include('../partials/header') %> <%- include('../partials/navbar') %>

    <main class="main-content">
      <div class="container"><%- body %></div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/main.js"></script>
  </body>
</html>
```

### Partials

**views/partials/head.ejs**:

```html
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= pageTitle %> - <%= siteName %></title>
  <link rel="stylesheet" href="/css/style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
</head>
```

**views/partials/navbar.ejs**:

```html
<nav class="navbar">
  <div class="container">
    <ul class="nav-links">
      <li class="<%= currentPath === '/' ? 'active' : '' %>">
        <a href="/"><i class="fas fa-home"></i> Home</a>
      </li>
      <li class="<%= currentPath.startsWith('/posts') ? 'active' : '' %>">
        <a href="/posts"><i class="fas fa-newspaper"></i> Posts</a>
      </li>
      <li class="<%= currentPath === '/create' ? 'active' : '' %>">
        <a href="/create"><i class="fas fa-plus"></i> Create Post</a>
      </li>
    </ul>
  </div>
</nav>
```

**views/partials/post-card.ejs**:

```html
<article class="post-card">
  <div class="post-card-header">
    <h3 class="post-title">
      <a href="/posts/<%= post.id %>"><%= post.title %></a>
    </h3>
  </div>

  <div class="post-card-body">
    <p class="post-excerpt"><%= truncateText(post.body, 150) %></p>
  </div>

  <div class="post-card-footer">
    <div class="post-author">
      <i class="fas fa-user"></i>
      <% if (users[post.userId]) { %> <%= users[post.userId].name %> <% } else {
      %> Unknown Author <% } %>
    </div>
    <a href="/posts/<%= post.id %>" class="read-more">
      Read More <i class="fas fa-arrow-right"></i>
    </a>
  </div>
</article>
```

### Pages

**views/pages/home.ejs**:

```html
<section class="hero">
  <h1>Welcome to <%= siteName %></h1>
  <p>Discover amazing articles powered by REST API</p>
  <a href="/posts" class="btn btn-primary">Explore Posts</a>
</section>

<section class="latest-posts">
  <h2>Latest Posts</h2>

  <% if (posts.length === 0) { %>
  <p>No posts available.</p>
  <% } else { %>
  <div class="posts-grid">
    <% posts.forEach(post => { %> <%- include('../partials/post-card', { post:
    post, users: users, truncateText: truncateText }) %> <% }); %>
  </div>
  <% } %>

  <div class="text-center">
    <a href="/posts" class="btn btn-secondary">View All Posts</a>
  </div>
</section>
```

**views/pages/posts.ejs**:

```html
<section class="posts-page">
  <div class="page-header">
    <h1>All Blog Posts</h1>

    <!-- Search Form -->
    <form action="/posts" method="GET" class="search-form">
      <input
        type="text"
        name="search"
        placeholder="Search posts..."
        value="<%= search %>"
        class="search-input"
      />
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i> Search
      </button>
    </form>
  </div>

  <% if (search) { %>
  <p class="search-results">
    Found <%= pagination.totalItems %> results for "<%= search %>"
    <a href="/posts" class="clear-search">Clear</a>
  </p>
  <% } %> <% if (posts.length === 0) { %>
  <div class="no-results">
    <p>No posts found.</p>
  </div>
  <% } else { %>
  <div class="posts-grid">
    <% posts.forEach(post => { %> <%- include('../partials/post-card', { post:
    post, users: users, truncateText: truncateText }) %> <% }); %>
  </div>

  <!-- Pagination -->
  <% if (pagination.totalPages > 1) { %>
  <div class="pagination">
    <% if (pagination.hasPrev) { %>
    <a
      href="?page=<%= pagination.currentPage - 1 %><%= search ? '&search=' + search : '' %>"
      class="page-link"
    >
      <i class="fas fa-chevron-left"></i> Previous
    </a>
    <% } %>

    <span class="page-info">
      Page <%= pagination.currentPage %> of <%= pagination.totalPages %>
    </span>

    <% if (pagination.hasNext) { %>
    <a
      href="?page=<%= pagination.currentPage + 1 %><%= search ? '&search=' + search : '' %>"
      class="page-link"
    >
      Next <i class="fas fa-chevron-right"></i>
    </a>
    <% } %>
  </div>
  <% } %> <% } %>
</section>
```

**views/pages/post-detail.ejs**:

```html
<article class="post-detail">
  <header class="post-header">
    <h1><%= post.title %></h1>

    <div class="post-meta">
      <div class="author-info">
        <i class="fas fa-user"></i>
        <% if (author) { %>
        <span><%= author.name %></span>
        <small>(<%= author.email %>)</small>
        <% } else { %>
        <span>Unknown Author</span>
        <% } %>
      </div>

      <div class="post-id">
        <i class="fas fa-hashtag"></i>
        Post ID: <%= post.id %>
      </div>
    </div>
  </header>

  <div class="post-content">
    <p><%= post.body %></p>
  </div>

  <div class="post-actions">
    <a href="/posts" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Back to Posts
    </a>
  </div>
</article>

<section class="comments-section">
  <h2>Comments (<%= comments.length %>)</h2>

  <% if (comments.length === 0) { %>
  <p>No comments yet.</p>
  <% } else { %>
  <div class="comments-list">
    <% comments.forEach(comment => { %>
    <div class="comment">
      <div class="comment-header">
        <strong><%= comment.name %></strong>
        <small><%= comment.email %></small>
      </div>
      <div class="comment-body">
        <p><%= comment.body %></p>
      </div>
    </div>
    <% }); %>
  </div>
  <% } %>
</section>
```

**views/pages/create-post.ejs**:

```html
<section class="create-post">
  <h1>Create New Post</h1>

  <% if (typeof error !== 'undefined' && error) { %>
  <div class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i>
    <%= error %>
  </div>
  <% } %>

  <form action="/create" method="POST" class="post-form">
    <div class="form-group">
      <label for="title">Post Title *</label>
      <input
        type="text"
        id="title"
        name="title"
        required
        value="<%= typeof formData !== 'undefined' ? formData.title || '' : '' %>"
        placeholder="Enter post title"
      />
    </div>

    <div class="form-group">
      <label for="body">Post Content *</label>
      <textarea
        id="body"
        name="body"
        rows="10"
        required
        placeholder="Write your post content..."
      >
<%= typeof formData !== 'undefined' ? formData.body || '' : '' %></textarea
      >
    </div>

    <div class="form-group">
      <label for="userId">Author ID</label>
      <input
        type="number"
        id="userId"
        name="userId"
        value="<%= typeof formData !== 'undefined' ? formData.userId || 1 : 1 %>"
        min="1"
        max="10"
      />
      <small>Use ID 1-10 (test users from API)</small>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-check"></i> Create Post
      </button>
      <a href="/posts" class="btn btn-secondary">
        <i class="fas fa-times"></i> Cancel
      </a>
    </div>
  </form>
</section>
```

## CSS Styling

**public/css/style.css** (excerpt):

```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: #333;
  background: #f4f4f4;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Posts Grid */
.posts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 30px;
  margin: 30px 0;
}

.post-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s;
}

.post-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin: 40px 0;
}

/* Buttons */
.btn {
  display: inline-block;
  padding: 10px 20px;
  text-decoration: none;
  border-radius: 5px;
  transition: all 0.3s;
  border: none;
  cursor: pointer;
}

.btn-primary {
  background: #007bff;
  color: white;
}

.btn-primary:hover {
  background: #0056b3;
}
```

## Testing the Application

### 1. Start Server

```bash
npm run dev
```

### 2. Test Routes

- `http://localhost:3000/` - Home page dengan latest posts
- `http://localhost:3000/posts` - All posts dengan pagination
- `http://localhost:3000/posts?search=qui` - Search posts
- `http://localhost:3000/posts/1` - Single post detail dengan comments
- `http://localhost:3000/create` - Create new post form

## Key Features Implemented

**API Integration** - Fetches data dari JSONPlaceholder API menggunakan Axios
dengan error handling.

**Pagination** - Custom pagination logic untuk handle large datasets dengan
navigation controls.

**Search Functionality** - Filter posts berdasarkan title atau body content.

**Dynamic Routing** - Route parameters untuk post details dengan related data
(author, comments).

**EJS Templating** - Layouts, partials, dan reusable components untuk
maintainable code.

**Error Handling** - Comprehensive error handling di server dan user-friendly
error pages.

**Responsive Design** - Mobile-first CSS dengan grid layout dan flexbox.

## Best Practices Applied

**Separation of Concerns** - Business logic di server, presentation di views,
styling di CSS.

**DRY Principle** - Reusable partials untuk components yang digunakan berulang.

**Error Handling** - Try-catch blocks dan global error handler untuk robustness.

**Environment Variables** - Configuration sensitive data di .env file.

**Code Organization** - Clear folder structure dan meaningful naming
conventions.

**Performance** - Parallel API calls dengan Promise.all() untuk faster loading.

---

**Ringkasan**: Capstone project ini mengintegrasikan semua konsep dari sesi
2.1-2.6: API integration dengan Axios, EJS templating dengan layouts dan
partials, Express routing, error handling, dan pagination. Aplikasi
mendemonstrasikan real-world scenario dimana server fetches data dari external
API, processes data, dan renders dynamic HTML menggunakan EJS templates.
Features seperti search, pagination, dan create post menunjukkan complete
CRUD-like operations workflow. Project ini adalah foundation solid untuk
building production-ready web applications dengan modern architecture patterns.
