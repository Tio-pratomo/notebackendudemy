---
title: "EJS Partials dan Layouts"
---

Setelah mempelajari basic EJS di sesi 2.5, sekarang kita akan belajar bagaimana
membuat aplikasi yang lebih maintainable dengan **EJS Partials** dan
**Layouts**. Konsep ini memungkinkan kita untuk reuse code dan menghindari
duplikasi HTML di berbagai halaman.

## Masalah: Code Duplication

Tanpa partials, setiap halaman harus menulis ulang code yang sama:

```html title="views/home.ejs"
<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="/about">About</a>
    </nav>

    <h1>Welcome to Home</h1>

    <footer>
      <p>&copy; 2025 My Site</p>
    </footer>
  </body>
</html>
```

```html title="views/about.ejs"
<!DOCTYPE html>
<html>
  <head>
    <title>About</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="/about">About</a>
    </nav>

    <h1>About Us</h1>

    <footer>
      <p>&copy; 2025 My Site</p>
    </footer>
  </body>
</html>
```

**Problem**: Header, navigation, dan footer di-duplicate di setiap file. Jika
ingin update navbar, harus edit semua file!

## Solusi: EJS Partials

**Partials** adalah template fragments yang bisa di-include ke template lain.
Seperti component yang bisa di-reuse di berbagai halaman.

### Setup Folder Structure

```
project/
├── views/
│   ├── partials/
│   │   ├── head.ejs
│   │   ├── header.ejs
│   │   ├── navbar.ejs
│   │   └── footer.ejs
│   ├── pages/
│   │   ├── home.ejs
│   │   ├── about.ejs
│   │   └── contact.ejs
│   └── layouts/
│       └── main.ejs
├── public/
│   ├── css/
│   └── js/
└── index.js
```

## Creating Partials

### 1. Head Partial

**views/partials/head.ejs**:

```html
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= pageTitle || 'My Website' %></title>
  <link rel="stylesheet" href="/css/style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
</head>
```

### 2. Header Partial

**views/partials/header.ejs**:

```html
<header class="site-header">
  <div class="container">
    <div class="logo">
      <a href="/">
        <i class="fas fa-rocket"></i>
        My Website
      </a>
    </div>
    <div class="user-info">
      <% if (user) { %>
      <span>Welcome, <%= user.name %></span>
      <a href="/logout">Logout</a>
      <% } else { %>
      <a href="/login">Login</a>
      <% } %>
    </div>
  </div>
</header>
```

### 3. Navbar Partial

**views/partials/navbar.ejs**:

```html
<nav class="main-nav">
  <ul>
    <li class="<%= currentPage === 'home' ? 'active' : '' %>">
      <a href="/"> <i class="fas fa-home"></i> Home </a>
    </li>
    <li class="<%= currentPage === 'about' ? 'active' : '' %>">
      <a href="/about"> <i class="fas fa-info-circle"></i> About </a>
    </li>
    <li class="<%= currentPage === 'products' ? 'active' : '' %>">
      <a href="/products"> <i class="fas fa-shopping-cart"></i> Products </a>
    </li>
    <li class="<%= currentPage === 'contact' ? 'active' : '' %>">
      <a href="/contact"> <i class="fas fa-envelope"></i> Contact </a>
    </li>
  </ul>
</nav>
```

### 4. Footer Partial

**views/partials/footer.ejs**:

```html
<footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>About Us</h3>
        <p>We are a modern web development company.</p>
      </div>
      <div class="footer-section">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li><a href="/terms">Terms of Service</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Follow Us</h3>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
    <p class="copyright">
      &copy; <%= new Date().getFullYear() %> My Website. All rights reserved.
    </p>
  </div>
</footer>
```

## Including Partials

Gunakan `<%- include('path/to/partial') %>` untuk include partial:

**views/pages/home.ejs**:

```html
<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head') %>
  <body>
    <%- include('../partials/header') %> <%- include('../partials/navbar') %>

    <main class="container">
      <h1>Welcome to Home Page</h1>
      <p>This is the main content area.</p>

      <div class="cards">
        <% products.forEach(product => { %>
        <div class="card">
          <h3><%= product.name %></h3>
          <p>$<%= product.price %></p>
        </div>
        <% }); %>
      </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/main.js"></script>
  </body>
</html>
```

## Passing Data to Partials

Partials dapat menerima data melalui second parameter:

```html
<!-- Include dengan data -->
<%- include('../partials/product-card', { product: product, showDetails: true })
%>
```

**views/partials/product-card.ejs**:

```html
<div class="product-card">
  <img src="<%= product.image %>" alt="<%= product.name %>" />
  <h3><%= product.name %></h3>
  <p class="price">$<%= product.price %></p>

  <% if (showDetails) { %>
  <p class="description"><%= product.description %></p>
  <button>View Details</button>
  <% } else { %>
  <button>Quick View</button>
  <% } %>
</div>
```

**Usage in main template**:

```html
<div class="products-grid">
  <% products.forEach(product => { %> <%- include('../partials/product-card', {
  product: product, showDetails: false }) %> <% }); %>
</div>
```

## Creating Reusable Components

### Alert Component

**views/partials/alert.ejs**:

```html
<% const alertClass = { success: 'alert-success', error: 'alert-error', warning:
'alert-warning', info: 'alert-info' }; %>

<div class="alert <%= alertClass[type] || 'alert-info' %>">
  <% if (type === 'success') { %>
  <i class="fas fa-check-circle"></i>
  <% } else if (type === 'error') { %>
  <i class="fas fa-exclamation-circle"></i>
  <% } else if (type === 'warning') { %>
  <i class="fas fa-exclamation-triangle"></i>
  <% } else { %>
  <i class="fas fa-info-circle"></i>
  <% } %>

  <span><%= message %></span>

  <% if (dismissible) { %>
  <button class="close-btn">&times;</button>
  <% } %>
</div>
```

**Usage**:

```html
<%- include('../partials/alert', { type: 'success', message: 'User created
successfully!', dismissible: true }) %> <%- include('../partials/alert', { type:
'error', message: 'Something went wrong.', dismissible: false }) %>
```

### Pagination Component

**views/partials/pagination.ejs**:

```html
<div class="pagination">
  <% if (currentPage > 1) { %>
  <a href="?page=<%= currentPage - 1 %>" class="page-link">
    <i class="fas fa-chevron-left"></i> Previous
  </a>
  <% } %> <% for (let i = 1; i <= totalPages; i++) { %> <% if (i ===
  currentPage) { %>
  <span class="page-link active"><%= i %></span>
  <% } else if (Math.abs(i - currentPage) <= 2 || i === 1 || i === totalPages) {
  %>
  <a href="?page=<%= i %>" class="page-link"><%= i %></a>
  <% } else if (Math.abs(i - currentPage) === 3) { %>
  <span class="page-link">...</span>
  <% } %> <% } %> <% if (currentPage < totalPages) { %>
  <a href="?page=<%= currentPage + 1 %>" class="page-link">
    Next <i class="fas fa-chevron-right"></i>
  </a>
  <% } %>
</div>
```

## Server Implementation

**index.js**:

```javascript
import express from "express";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();

app.set("view engine", "ejs");
app.set("views", path.join(__dirname, "views"));
app.use(express.static("public"));

// Middleware untuk set default locals
app.use((req, res, next) => {
  res.locals.siteName = "My Awesome Site";
  res.locals.currentYear = new Date().getFullYear();
  res.locals.user = req.session?.user || null; // Dari session
  next();
});

// Home page
app.get("/", (req, res) => {
  const products = [
    { id: 1, name: "Laptop", price: 999, image: "/images/laptop.jpg" },
    { id: 2, name: "Phone", price: 699, image: "/images/phone.jpg" },
    { id: 3, name: "Tablet", price: 499, image: "/images/tablet.jpg" },
  ];

  res.render("pages/home", {
    pageTitle: "Home - Shop",
    currentPage: "home",
    products: products,
  });
});

// Products page dengan pagination
app.get("/products", (req, res) => {
  const page = parseInt(req.query.page) || 1;
  const limit = 12;
  const totalProducts = 100;
  const totalPages = Math.ceil(totalProducts / limit);

  res.render("pages/products", {
    pageTitle: "Products",
    currentPage: "products",
    products: [], // Fetch from database
    currentPage: page,
    totalPages: totalPages,
  });
});

// About page
app.get("/about", (req, res) => {
  res.render("pages/about", {
    pageTitle: "About Us",
    currentPage: "about",
  });
});

app.listen(3000, () => {
  console.log("Server running on http://localhost:3000");
});
```

## Layout Pattern (Alternative Approach)

Untuk aplikasi yang lebih kompleks, bisa menggunakan layout pattern:

**views/layouts/main.ejs**:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= pageTitle %> - <%= siteName %></title>
    <link rel="stylesheet" href="/css/style.css" />
    <%- extraStyles || '' %>
  </head>
  <body>
    <%- include('../partials/header') %> <%- include('../partials/navbar') %>

    <main class="main-content">
      <div class="container">
        <!-- Flash messages -->
        <% if (successMessage) { %> <%- include('../partials/alert', { type:
        'success', message: successMessage, dismissible: true }) %> <% } %> <%
        if (errorMessage) { %> <%- include('../partials/alert', { type: 'error',
        message: errorMessage, dismissible: true }) %> <% } %>

        <!-- Main content from child template -->
        <%- body %>
      </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/main.js"></script>
    <%- extraScripts || '' %>
  </body>
</html>
```

**Note**: EJS tidak memiliki native layout system seperti Pug atau Handlebars.
Untuk true layouts, gunakan package `express-ejs-layouts`:

```bash
npm install express-ejs-layouts
```

```javascript
import expressLayouts from "express-ejs-layouts";

app.use(expressLayouts);
app.set("layout", "layouts/main");
app.set("layout extractScripts", true);
app.set("layout extractStyles", true);
```

## Best Practices

**Keep partials small and focused** - Satu partial untuk satu purpose (navbar,
footer, card, dll).

**Use meaningful names** - Gunakan nama yang jelas seperti `product-card.ejs`,
bukan `card1.ejs`.

**Pass data explicitly** - Jangan rely pada global variables, pass data sebagai
parameter.

**Organize by type** - Group partials berdasarkan fungsi (layout, components,
widgets).

**Reuse wisely** - Jangan membuat partial untuk code yang hanya dipakai sekali.

**Document complex partials** - Tambahkan comment untuk explain parameters dan
usage.

**Use res.locals** - Set data umum di middleware dengan `res.locals` agar
otomatis available di semua views.

**Avoid deep nesting** - Jangan include partials di dalam partials terlalu dalam
(max 2-3 level).

## Common Use Cases

**Navigation bars** - Share navigation across all pages.

**Headers and footers** - Consistent branding dan copyright info.

**Form components** - Input fields, buttons, validation messages.

**Cards and tiles** - Product cards, blog post previews.

**Loading states** - Spinners, skeleton screens.

**Error messages** - Consistent error display.

**Modals and dialogs** - Popup windows dan confirmations.

**Pagination** - Page navigation controls.

---

**Ringkasan**: EJS Partials memungkinkan code reusability dengan memecah
template menjadi reusable fragments yang bisa di-include di berbagai halaman
menggunakan `<%- include('path/to/partial') %>`. Partials dapat menerima data
sebagai parameter untuk customization dan sangat berguna untuk komponen yang
dipakai berulang seperti navbar, footer, cards, alerts, dan pagination. Best
practices meliputi keeping partials focused, using meaningful names, passing
data explicitly, dan organizing files dengan struktur folder yang jelas. Untuk
layout system yang lebih advanced, gunakan package `express-ejs-layouts` yang
menyediakan true layout inheritance. Dengan partials, aplikasi menjadi lebih
maintainable karena perubahan pada shared components hanya perlu dilakukan di
satu tempat.
