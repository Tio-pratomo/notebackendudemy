---
title: "Request Object Deep Dive"
---

Objek `req` (request) adalah salah satu parameter paling penting dalam Express yang berisi semua informasi tentang permintaan HTTP yang masuk dari client. Memahami property dan method dari `req` memungkinkan kita membuat aplikasi yang lebih powerful dan responsif terhadap berbagai jenis permintaan.

## Apa itu Request Object?

Request object adalah objek yang merepresentasikan HTTP request dan memiliki berbagai property untuk query string, parameters, body, HTTP headers, dan lainnya. Setiap kali client mengirim request ke server, Express otomatis membuat objek `req` yang berisi semua detail tentang permintaan tersebut.

```javascript
app.get('/example', (req, res) => {
    // req berisi semua informasi tentang request
    console.log(req.method);    // HTTP method
    console.log(req.url);       // URL path
    console.log(req.headers);   // HTTP headers
});
```

## Property Penting dari req

### req.params

Property ini berisi route parameters yang didefinisikan dalam path route. Route parameters adalah bagian dinamis dari URL yang digunakan untuk mengidentifikasi resource spesifik.

```javascript
// Route dengan single parameter
app.get('/users/:userId', (req, res) => {
    const userId = req.params.userId;
    res.send(`User ID: ${userId}`);
});
// Akses: /users/123 → req.params.userId = "123"

// Route dengan multiple parameters
app.get('/posts/:category/:postId', (req, res) => {
    const { category, postId } = req.params;
    res.json({ category, postId });
});
// Akses: /posts/tech/456 → { category: "tech", postId: "456" }

// Nested parameters
app.get('/users/:userId/comments/:commentId', (req, res) => {
    console.log(req.params);
    // { userId: '42', commentId: '789' }
    res.send(`User ${req.params.userId}, Comment ${req.params.commentId}`);
});
```

**Penting**: Semua nilai dalam `req.params` adalah string, jadi jika memerlukan number, harus dikonversi dengan `parseInt()` atau `Number()`.

### req.query

Property ini berisi query string parameters yang dikirim setelah tanda `?` di URL. Query parameters biasanya digunakan untuk filtering, sorting, atau pagination.

```javascript
app.get('/search', (req, res) => {
    console.log(req.query);
    const { keyword, page, limit, sort } = req.query;
    
    res.json({
        keyword: keyword || 'all',
        page: page || 1,
        limit: limit || 10,
        sort: sort || 'asc'
    });
});
// Akses: /search?keyword=nodejs&page=2&limit=20&sort=desc
// Output: { keyword: "nodejs", page: "2", limit: "20", sort: "desc" }
```

**Tips**: Query parameters bersifat optional dan selalu string, gunakan default values untuk handling ketika tidak ada.

### req.body

Property ini berisi data yang dikirim dalam body HTTP request, biasanya dari form POST atau API JSON. Untuk menggunakan `req.body`, wajib menggunakan middleware parser seperti `express.json()` atau `express.urlencoded()`.

```javascript
import express from 'express';
const app = express();

// Middleware untuk parsing JSON
app.use(express.json());

// Middleware untuk parsing form data
app.use(express.urlencoded({ extended: true }));

// Route POST dengan JSON data
app.post('/api/users', (req, res) => {
    const { name, email, age } = req.body;
    console.log('Received:', req.body);
    // { name: "John", email: "john@example.com", age: 25 }
    
    res.status(201).json({
        message: 'User created',
        user: { name, email, age }
    });
});

// Route POST dengan form data
app.post('/submit-form', (req, res) => {
    const { username, password } = req.body;
    res.send(`Form submitted by ${username}`);
});
```

### req.headers

Property ini berisi semua HTTP headers yang dikirim oleh client. Headers berisi metadata tentang request seperti content-type, authorization, user-agent, dll.

```javascript
app.get('/info', (req, res) => {
    console.log(req.headers);
    
    res.json({
        contentType: req.headers['content-type'],
        userAgent: req.headers['user-agent'],
        authorization: req.headers['authorization'],
        accept: req.headers['accept']
    });
});

// Contoh headers:
// {
//   'content-type': 'application/json',
//   'user-agent': 'Mozilla/5.0...',
//   'authorization': 'Bearer token123',
//   'accept': '*/*'
// }
```

**Catatan**: Header names di `req.headers` selalu lowercase.

### req.cookies

Property ini berisi cookies yang dikirim oleh client. Untuk menggunakan `req.cookies`, perlu middleware `cookie-parser`.

```javascript
import cookieParser from 'cookie-parser';

app.use(cookieParser());

app.get('/check-cookies', (req, res) => {
    console.log(req.cookies);
    
    if (req.cookies.sessionId) {
        res.send(`Session ID: ${req.cookies.sessionId}`);
    } else {
        res.send('No session cookie found');
    }
});

// Set cookie
app.get('/set-cookie', (req, res) => {
    res.cookie('username', 'john', { maxAge: 900000 });
    res.send('Cookie has been set');
});
```

### req.ip

Property ini berisi IP address dari client yang membuat request.

```javascript
app.get('/ip-info', (req, res) => {
    console.log('Client IP:', req.ip);
    res.json({ 
        yourIp: req.ip,
        message: 'This is your IP address' 
    });
});
// Output: ::1 (untuk localhost) atau 192.168.1.100
```

### req.hostname

Property ini berisi hostname dari request URL.

```javascript
app.get('/host-info', (req, res) => {
    console.log('Hostname:', req.hostname);
    res.json({ hostname: req.hostname });
});
// Akses dari http://localhost:3000 → hostname: "localhost"
// Akses dari http://example.com → hostname: "example.com"
```

### req.path

Property ini berisi path portion dari URL request.

```javascript
app.get('/users/:id/profile', (req, res) => {
    console.log('Path:', req.path);
    res.json({ path: req.path });
});
// Akses: /users/123/profile → path: "/users/123/profile"
```

### req.protocol

Property ini berisi protocol yang digunakan (http atau https).

```javascript
app.get('/protocol', (req, res) => {
    console.log('Protocol:', req.protocol);
    res.json({ 
        protocol: req.protocol,
        isSecure: req.secure 
    });
});
// Output: { protocol: "http", isSecure: false }
```

### req.secure

Property boolean yang menunjukkan apakah koneksi menggunakan HTTPS.

```javascript
app.use((req, res, next) => {
    if (!req.secure && process.env.NODE_ENV === 'production') {
        return res.redirect('https://' + req.hostname + req.url);
    }
    next();
});
```

### req.method

Property ini berisi HTTP method dari request (GET, POST, PUT, DELETE, dll).

```javascript
app.use((req, res, next) => {
    console.log(`${req.method} request to ${req.url}`);
    next();
});
// Output: GET request to /api/users
```

### req.url dan req.originalUrl

`req.url` berisi URL path dengan query string, sedangkan `req.originalUrl` menyimpan URL asli sebelum dimodifikasi oleh middleware.

```javascript
app.get('/api/users', (req, res) => {
    console.log('URL:', req.url);
    console.log('Original URL:', req.originalUrl);
    res.send('Check console');
});
// Akses: /api/users?page=2
// URL: /api/users?page=2
// Original URL: /api/users?page=2
```

## Method Penting dari req

### req.get(header)

Method untuk mendapatkan nilai dari HTTP request header.

```javascript
app.get('/headers', (req, res) => {
    const contentType = req.get('Content-Type');
    const userAgent = req.get('User-Agent');
    const authorization = req.get('Authorization');
    
    res.json({
        contentType,
        userAgent,
        authorization: authorization ? 'Present' : 'Missing'
    });
});
```

**Alias**: `req.header()` adalah alias dari `req.get()`.

### req.accepts(types)

Method untuk memeriksa content type apa yang diterima oleh client berdasarkan Accept header.

```javascript
app.get('/data', (req, res) => {
    const accepts = req.accepts(['json', 'html', 'text']);
    
    if (accepts === 'json') {
        res.json({ data: [1, 2, 3] });
    } else if (accepts === 'html') {
        res.send('<html><body>Data</body></html>');
    } else {
        res.send('Plain text data');
    }
});

// Atau check specific type
app.get('/api/resource', (req, res) => {
    if (req.accepts('json')) {
        res.json({ message: 'JSON response' });
    } else {
        res.status(406).send('Not Acceptable');
    }
});
```

### req.is(type)

Method untuk memeriksa Content-Type dari incoming request.

```javascript
app.post('/upload', (req, res) => {
    if (req.is('json')) {
        res.send('Received JSON data');
    } else if (req.is('application/x-www-form-urlencoded')) {
        res.send('Received form data');
    } else if (req.is('multipart/form-data')) {
        res.send('Received file upload');
    } else {
        res.status(415).send('Unsupported Media Type');
    }
});
```

### req.range(size)

Method untuk parsing Range header untuk mendukung partial content download.

```javascript
import fs from 'fs';
import path from 'path';

app.get('/download-file', (req, res) => {
    const filePath = path.join(__dirname, 'large_file.txt');
    const stat = fs.statSync(filePath);
    const fileSize = stat.size;
    const rangeHeader = req.get('Range');
    
    if (rangeHeader) {
        const ranges = req.range(fileSize);
        if (ranges && ranges.type === 'bytes') {
            const { start, end } = ranges;
            const chunksize = (end - start) + 1;
            const fileStream = fs.createReadStream(filePath, { start, end });
            
            res.status(206); // Partial Content
            res.setHeader('Content-Range', `bytes ${start}-${end}/${fileSize}`);
            res.setHeader('Content-Length', chunksize);
            
            fileStream.pipe(res);
        }
    } else {
        res.sendFile(filePath);
    }
});
```

## Contoh Praktis Komprehensif

```javascript
import express from 'express';
import cookieParser from 'cookie-parser';

const app = express();
const port = 3000;

// Middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(cookieParser());

// Logger middleware menggunakan req properties
app.use((req, res, next) => {
    console.log('=== Request Info ===');
    console.log('Method:', req.method);
    console.log('URL:', req.url);
    console.log('IP:', req.ip);
    console.log('Hostname:', req.hostname);
    console.log('Protocol:', req.protocol);
    console.log('Secure:', req.secure);
    console.log('User-Agent:', req.get('User-Agent'));
    console.log('==================');
    next();
});

// Route dengan berbagai req properties
app.get('/user/:userId/posts/:postId', (req, res) => {
    // Route parameters
    const { userId, postId } = req.params;
    
    // Query parameters
    const { page, limit, sort } = req.query;
    
    // Headers
    const contentType = req.get('Content-Type');
    const userAgent = req.get('User-Agent');
    
    // Cookies
    const sessionId = req.cookies.sessionId;
    
    res.json({
        params: { userId, postId },
        query: { page, limit, sort },
        headers: { contentType, userAgent },
        cookies: { sessionId },
        requestInfo: {
            method: req.method,
            path: req.path,
            url: req.url,
            ip: req.ip,
            hostname: req.hostname,
            protocol: req.protocol
        }
    });
});

// POST route dengan body
app.post('/api/users', (req, res) => {
    // Check Content-Type
    if (!req.is('json')) {
        return res.status(400).json({ 
            error: 'Content-Type must be application/json' 
        });
    }
    
    const { name, email, age } = req.body;
    
    // Validation
    if (!name || !email) {
        return res.status(400).json({ 
            error: 'Name and email are required' 
        });
    }
    
    res.status(201).json({
        message: 'User created',
        user: { name, email, age }
    });
});

// Content negotiation dengan accepts()
app.get('/data', (req, res) => {
    const data = { items: [1, 2, 3, 4, 5] };
    
    if (req.accepts('json')) {
        res.json(data);
    } else if (req.accepts('html')) {
        res.send(`<html><body><pre>${JSON.stringify(data, null, 2)}</pre></body></html>`);
    } else {
        res.type('text').send(JSON.stringify(data));
    }
});

app.listen(port, () => {
    console.log(`Server running on http://localhost:${port}`);
});
```

## Testing Request Properties

Untuk testing, gunakan Postman atau curl:

```bash
# Test route parameters dan query
curl http://localhost:3000/user/123/posts/456?page=2&limit=10

# Test POST dengan JSON body
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"John","email":"john@example.com","age":25}'

# Test dengan custom headers
curl http://localhost:3000/data \
  -H "Accept: application/json" \
  -H "Authorization: Bearer token123"
```

## Best Practices

**Validation**: Selalu validasi data dari `req.params`, `req.query`, dan `req.body` sebelum menggunakannya.

**Type conversion**: Parameter dari URL selalu string, konversi ke tipe data yang sesuai.

**Default values**: Gunakan default values untuk query parameters yang optional.

**Security**: Jangan percaya input dari client, selalu sanitasi dan validasi.

**Error handling**: Berikan error messages yang informatif untuk invalid inputs.

---

**Ringkasan**: Request object adalah jantung dari aplikasi Express yang berisi semua informasi tentang HTTP request. Property utama meliputi `req.params` untuk route parameters, `req.query` untuk query strings, `req.body` untuk request body, `req.headers` untuk HTTP headers, dan berbagai property lain seperti `req.ip`, `req.hostname`, `req.method`. Method penting seperti `req.get()`, `req.accepts()`, dan `req.is()` membantu dalam content negotiation dan request validation. Memahami request object dengan baik adalah fondasi untuk membuat API yang robust dan secure.

